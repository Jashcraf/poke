FCT @RAYRSI_GRID(num ^input_array(2,1024),num ^output_array_x(3,1024),num ^output_array_y(3,1024),num ^Hx,num ^Hy,num ^nrays,num ^nsurf)

num ^data(4)

    FOR ^iter_ray 1 ^nrays

        ^data(1) = ^input_array(1,^iter_ray) ! Px cord
        ^data(2) = ^input_array(2,^iter_ray) ! Py cord
        ^data(3) = ^Hx ! Hx cord
        ^data(4) = ^Hy ! Hy cord

        ! run rayrsi to give coords of all surfaces
        !ok == rayrsi(1,1,0,0,^data)

        FOR ^iter_surf 1 ^nsurf

            ! grab ray coordinates from database
            ^output_array_x(^iter_ray,^iter_surf) == (x s^iter_surf)
            ^output_array_y(^iter_ray,^iter_surf) == (y s^iter_surf)

        END FOR
    END FOR

END FCT ^output_array_x