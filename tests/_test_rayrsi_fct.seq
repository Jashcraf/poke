! testing rayrsi

num ^data(4)
num ^nsurf
num ^nrays
num ^output_array_x(1024,3)


FCT @RAYSI_GRID(^input_array,^output_array_x,^output_array_y,^Hx,^Hy)

    FOR ^iter_ray 1 ^nrays

        ^data(1) = ^input_array(1,^iter_ray) ! Px cord
        ^data(2) = ^input_array(2,^iter_ray) ! Py cord
        ^data(3) = ^Hx ! Hx cord
        ^data(4) = ^Hy ! Hy cord

        ! run rayrsi to give coords of all surfaces
        ok == rayrsi(1,1,0,0,^data)

        FOR ^iter_surf 1 ^nsurf

            ! grab ray coordinates from database
            ^output_array_x(^iter_ray,^iter_surf) == (x s^iter_surf)
            ^output_array_y(^iter_ray,^iter_surf) == (y s^iter_surf)

        END FOR
    END FOR

END FCT ^output_array_x ^output_array_y


^nsurf == 3
^nrays == 1024


res hubble_test.len
rof x y z l m n srl srm srn aoi aor

wri "did data load"
wri ^data(1)

^nsurf == (num s)

