<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generating a Jones Pupil and propagating it with HCIPy &amp; Poppy &mdash; poke v1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="About poke" href="aboutpoke.html" />
    <link rel="prev" title="Intro to Poke: Polarization Ray Tracing" href="introtopolarization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> poke
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../modules.html">poke</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="rayfrontattributes.html">Displaying Footprint Diagrams and Ray OPDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="introtopolarization.html">Intro to Poke: Polarization Ray Tracing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Generating a Jones Pupil and propagating it with HCIPy &amp; Poppy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Now-Let’s-Compute-a-Jones-Pupil-using-our-data-from-above">Now Let’s Compute a Jones Pupil using our data from above</a></li>
<li class="toctree-l2"><a class="reference internal" href="#HCIPy’s-Partially-Polarized-Wavefront">HCIPy’s Partially Polarized Wavefront</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Time-to-send-the-wavefront-through-the-Fraunhofer-Propagator">Time to send the wavefront through the Fraunhofer Propagator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Now-Pass-this-data-through-a-linear-polarizing-beam-splitter">Now Pass this data through a linear polarizing beam splitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Great!-Now-let’s-try-the-same-with-Poppy">Great! Now let’s try the same with Poppy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aboutpoke.html">About poke</a></li>
<li class="toctree-l1"><a class="reference internal" href="thinfilm_optimization.html">Simulating Multilayer Thin Films</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">poke</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Generating a Jones Pupil and propagating it with HCIPy &amp; Poppy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/jonespupils.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">poke.poke_core</span> <span class="k">as</span> <span class="nn">pol</span>
<span class="kn">import</span> <span class="nn">poke.raytrace</span> <span class="k">as</span> <span class="nn">ray</span>
<span class="kn">import</span> <span class="nn">poke.plotting</span> <span class="k">as</span> <span class="nn">plot</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<section id="Generating-a-Jones-Pupil-and-propagating-it-with-HCIPy-&amp;-Poppy">
<h1>Generating a Jones Pupil and propagating it with HCIPy &amp; Poppy<a class="headerlink" href="#Generating-a-Jones-Pupil-and-propagating-it-with-HCIPy-&-Poppy" title="Permalink to this headline"></a></h1>
<p>In this example we will start with the computation of a Jones pupil of the Hubble Space Telescope. Then we will use HCIPy and POPPY to propagate to the image plane.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize a Raybundle</span>
<span class="n">nrays</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">n1</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">n2</span> <span class="o">=</span> <span class="mf">1.0194</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mf">6.6388</span> <span class="c1"># Al in v band</span>
<span class="n">radius</span> <span class="o">=</span> <span class="mf">1.2</span>
<span class="n">ffov</span> <span class="o">=</span> <span class="mf">0.08</span>
<span class="n">wlen</span> <span class="o">=</span> <span class="mf">551e-9</span>
<span class="n">pth</span> <span class="o">=</span> <span class="s2">&quot;C:/Users/douglase/Desktop/poke/test_files/Hubble_Test.zmx&quot;</span>

<span class="c1"># Surface parameters are defined with Python dictionaries.</span>
<span class="c1"># &#39;surf&#39; is the surface number in the raytrace lens data editor</span>
<span class="c1"># &#39;coating&#39; is the thin film information. For a single layer, it&#39;s just the refractive index</span>
<span class="n">s1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;surf&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;coating&#39;</span><span class="p">:</span><span class="n">n2</span>
<span class="p">}</span>

<span class="n">s2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;surf&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;coating&#39;</span><span class="p">:</span><span class="n">n2</span>
<span class="p">}</span>

<span class="n">raybundle</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">Rayfront</span><span class="p">(</span><span class="n">nrays</span><span class="p">,</span><span class="n">wlen</span><span class="p">,</span><span class="n">radius</span><span class="p">,</span><span class="n">ffov</span><span class="p">,</span><span class="n">circle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">raybundle</span><span class="o">.</span><span class="n">as_polarized</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">])</span> <span class="c1"># pass the raybundle the surface list</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
norm fov =  [0. 0.]
base ray shape  (4, 12644)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the surface data can be seen with the surfaces attribute</span>
<span class="n">raybundle</span><span class="o">.</span><span class="n">surfaces</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;surf&#39;: 2, &#39;coating&#39;: (1.0194-6.6388j)},
 {&#39;surf&#39;: 4, &#39;coating&#39;: (1.0194-6.6388j)}]
</pre></div></div>
</div>
<p>The code below is known to throw an error. This is a problem with iPython and the zosapi that we are still working out, but executing this code in a .py file works just fine</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now propagate through the zemax optical system</span>
<span class="n">raybundle</span><span class="o">.</span><span class="n">TraceRaysetZOS</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span><span class="n">surfaces</span><span class="o">=</span><span class="p">[</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">FileNotFoundException</span>                     Traceback (most recent call last)
Cell <span class="ansi-green-intense-fg ansi-bold">In[4], line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># Now propagate through the zemax optical system</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 2</span> <span class="ansi-yellow-bg">raybundle</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">TraceRaysetZOS</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">pth</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg">surfaces</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">s1</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg">s2</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-intense-fg ansi-bold">~\Desktop\poke\poke\poke_core.py:191</span>, in <span class="ansi-cyan-fg">Rayfront.TraceRaysetZOS</span><span class="ansi-blue-intense-fg ansi-bold">(self, pth, wave, surfaces)</span>
<span class="ansi-green-fg">    184</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>surfaces <span style="color: rgb(98,98,98)">=</span> surfaces
<span class="ansi-green-fg">    186</span> <span style="color: rgb(175,0,0)">&#34;&#34;&#34;Traces rays through zemax opticstudio</span>
<span class="ansi-green-fg">    187</span>
<span class="ansi-green-fg">    188</span> <span style="color: rgb(175,0,0)">xData (etc.) has shape [len(raysets),len(surflist),maxrays] from TraceThroughZOS</span>
<span class="ansi-green-fg">    189</span> <span style="color: rgb(175,0,0)">&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 191</span> positions,directions,normals,<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>opd <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">rt</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">TraceThroughZOS</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">raysets</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg">pth</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">surfaces</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">nrays</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg">wave</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">global_coords</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    192</span> <span style="color: rgb(95,135,135)"># Remember that these dimensions are</span>
<span class="ansi-green-fg">    193</span> <span style="color: rgb(95,135,135)"># 0 : rayset</span>
<span class="ansi-green-fg">    194</span> <span style="color: rgb(95,135,135)"># 1 : surface #</span>
<span class="ansi-green-fg">    195</span> <span style="color: rgb(95,135,135)"># 2 : ray coordinate value</span>
<span class="ansi-green-fg">    197</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>xData <span style="color: rgb(98,98,98)">=</span> positions[<span style="color: rgb(98,98,98)">0</span>]

File <span class="ansi-green-intense-fg ansi-bold">~\Desktop\poke\poke\raytrace.py:63</span>, in <span class="ansi-cyan-fg">TraceThroughZOS</span><span class="ansi-blue-intense-fg ansi-bold">(raysets, pth, surflist, nrays, wave, global_coords)</span>
<span class="ansi-green-fg">     60</span> dll <span style="color: rgb(98,98,98)">=</span> os<span style="color: rgb(98,98,98)">.</span>path<span style="color: rgb(98,98,98)">.</span>join(os<span style="color: rgb(98,98,98)">.</span>path<span style="color: rgb(98,98,98)">.</span>dirname(os<span style="color: rgb(98,98,98)">.</span>path<span style="color: rgb(98,98,98)">.</span>realpath(<span style="color: rgb(0,0,135)">__file__</span>)),<span style="color: rgb(175,0,0)">r</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Raytrace.dll</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-fg">     61</span> clr<span style="color: rgb(98,98,98)">.</span>AddReference(dll)
<span class="ansi-green-intense-fg ansi-bold">---&gt; 63</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> <span class="ansi-bold" style="color: rgb(0,0,255)">BatchRayTrace</span>
<span class="ansi-green-fg">     65</span> zos <span style="color: rgb(98,98,98)">=</span> zosapi<span style="color: rgb(98,98,98)">.</span>App()
<span class="ansi-green-fg">     66</span> TheSystem <span style="color: rgb(98,98,98)">=</span> zos<span style="color: rgb(98,98,98)">.</span>TheSystem

File <span class="ansi-green-intense-fg ansi-bold">&lt;frozen importlib._bootstrap&gt;:991</span>, in <span class="ansi-cyan-fg">_find_and_load</span><span class="ansi-blue-intense-fg ansi-bold">(name, import_)</span>

File <span class="ansi-green-intense-fg ansi-bold">&lt;frozen importlib._bootstrap&gt;:975</span>, in <span class="ansi-cyan-fg">_find_and_load_unlocked</span><span class="ansi-blue-intense-fg ansi-bold">(name, import_)</span>

File <span class="ansi-green-intense-fg ansi-bold">&lt;frozen importlib._bootstrap&gt;:657</span>, in <span class="ansi-cyan-fg">_load_unlocked</span><span class="ansi-blue-intense-fg ansi-bold">(spec)</span>

File <span class="ansi-green-intense-fg ansi-bold">&lt;frozen importlib._bootstrap&gt;:556</span>, in <span class="ansi-cyan-fg">module_from_spec</span><span class="ansi-blue-intense-fg ansi-bold">(spec)</span>

File <span class="ansi-green-intense-fg ansi-bold">&lt;string&gt;:15</span>, in <span class="ansi-cyan-fg">create_module</span><span class="ansi-blue-intense-fg ansi-bold">(klass, spec)</span>

<span class="ansi-red-intense-fg ansi-bold">FileNotFoundException</span>: Could not load file or assembly &#39;ZOSAPI_Interfaces, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&#39; or one of its dependencies. The system cannot find the file specified.
File name: &#39;ZOSAPI_Interfaces, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&#39;
   at System.Signature.GetSignature(Void* pCorSig, Int32 cCorSig, RuntimeFieldHandleInternal fieldHandle, IRuntimeMethodInfo methodHandle, RuntimeType declaringType)
   at System.Reflection.RuntimeConstructorInfo.GetParametersNoCopy()
   at System.Reflection.MethodBase.GetParameterTypes()
   at System.Reflection.MethodBase.FormatNameAndSig(Boolean serialization)
   at System.Reflection.RuntimeConstructorInfo.ToString()
   at Python.Runtime.MethodObject..ctor(MaybeType type, String name, MethodBase[] info, Boolean allow_threads)
   at Python.Runtime.ClassManager.GetClassInfo(Type type, ClassBase impl)
   at Python.Runtime.ClassManager.InitClassBase(Type type, ClassBase impl, ReflectedClrType pyType)
   at Python.Runtime.ReflectedClrType.GetOrCreate(Type type)
   at Python.Runtime.ModuleObject.GetAttribute(String name, Boolean guess)
   at Python.Runtime.ModuleObject.LoadNames()
   at Python.Runtime.ImportHook.Import(String modname)
   at Python.Runtime.CLRModule._load_clr_module(PyObject spec)

WRN: Assembly binding logging is turned OFF.
To enable assembly bind failure logging, set the registry value [HKLM\Software\Microsoft\Fusion!EnableLog] (DWORD) to 1.
Note: There is some performance penalty associated with assembly bind failure logging.
To turn this feature off, remove the registry value [HKLM\Software\Microsoft\Fusion!EnableLog].

</pre></div></div>
</div>
<p>For now, we open a pre-made rayset that’s been pickled <code class="docutils literal notranslate"><span class="pre">raybundle_polarized.pickle</span></code> by the <code class="docutils literal notranslate"><span class="pre">gen_rayset</span></code> script</p>
<p>Keep in mind that pickle is not a secure data structure, and is only used here for example purposes until a more formal file structure is made for poke. Below is the warning from python</p>
<p>“It is possible to construct malicious pickle data which will execute arbitrary code during unpickling. Never unpickle data that could have come from an untrusted source, or that could have been tampered with.”</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;raybundle_polarized.pickle&quot;</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">raybundle</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The raybundle is back!</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">raybundle</span><span class="o">.</span><span class="n">PlotRaysAtSurface</span><span class="p">(</span><span class="n">surf</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_9_0.png" src="../_images/notebooks_jonespupils_9_0.png" />
</div>
</div>
<section id="Now-Let’s-Compute-a-Jones-Pupil-using-our-data-from-above">
<h2>Now Let’s Compute a Jones Pupil using our data from above<a class="headerlink" href="#Now-Let’s-Compute-a-Jones-Pupil-using-our-data-from-above" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is our surface data</span>
<span class="n">raybundle</span><span class="o">.</span><span class="n">surfaces</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;surf&#39;: 2, &#39;coating&#39;: (1.0194-6.6388j), &#39;mode&#39;: &#39;reflect&#39;},
 {&#39;surf&#39;: 4, &#39;coating&#39;: (1.0194-6.6388j), &#39;mode&#39;: &#39;reflect&#39;}]
</pre></div></div>
</div>
<p>What we are doing here is a transformation from the PRT matrix (in global coordinates) to the Jones matrix (in local coordinates). This requires two vectors. - <em>aloc</em>: which is the direction the optical axis is pointing in global coordinates - <em>exit_x</em>: which direction will be the local x-axis after the transformation</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the Jones Pupil from the ZOS raytrace and coating data</span>
<span class="n">raybundle</span><span class="o">.</span><span class="n">ComputeJonesPupil</span><span class="p">(</span><span class="n">aloc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">]),</span>
                            <span class="n">exit_x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="o">.</span><span class="n">JonesPupil</span><span class="p">(</span><span class="n">raybundle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_14_0.png" src="../_images/notebooks_jonespupils_14_0.png" />
</div>
</div>
<p>Excellent, now we have a full description of the polarization-dependent transformation our optical system imposes on an incoming field! Now, let’s use our favorite diffraction propagators to compute a PSF!</p>
</section>
<section id="HCIPy’s-Partially-Polarized-Wavefront">
<h2>HCIPy’s Partially Polarized Wavefront<a class="headerlink" href="#HCIPy’s-Partially-Polarized-Wavefront" title="Permalink to this headline"></a></h2>
<p>HICPy is the only open-source high-contrast imaging simulator (to my knowledge) to have modules for polarization so we will be using one of them to compute the PSF of a generally polarized wavefront following this example <a class="reference external" href="https://docs.hcipy.org/0.3.1/tutorials/PolarizationIntro/PolarizationIntro.html">this example</a> with some small modifications</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hcipy</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grab the Jones Pupil as numpy arrays</span>
<span class="n">J00</span> <span class="o">=</span> <span class="n">raybundle</span><span class="o">.</span><span class="n">JonesPupil</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="c1">#.reshape([256,256])</span>
<span class="n">J01</span> <span class="o">=</span> <span class="n">raybundle</span><span class="o">.</span><span class="n">JonesPupil</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="c1">#.reshape([256,256])</span>
<span class="n">J10</span> <span class="o">=</span> <span class="n">raybundle</span><span class="o">.</span><span class="n">JonesPupil</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="c1">#.reshape([256,256])</span>
<span class="n">J11</span> <span class="o">=</span> <span class="n">raybundle</span><span class="o">.</span><span class="n">JonesPupil</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="c1">#.reshape([256,256])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pupil_grid</span> <span class="o">=</span> <span class="n">make_pupil_grid</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
<span class="n">aperture</span> <span class="o">=</span> <span class="n">make_magellan_aperture</span><span class="p">(</span><span class="kc">True</span><span class="p">)(</span><span class="n">pupil_grid</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">imshow_field</span><span class="p">(</span><span class="n">aperture</span><span class="o">*</span><span class="n">J00</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.colorbar.Colorbar at 0x247882980a0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_18_1.png" src="../_images/notebooks_jonespupils_18_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jones_matrix</span> <span class="o">=</span> <span class="n">Field</span><span class="p">([[</span><span class="n">aperture</span><span class="o">*</span><span class="n">J00</span><span class="p">,</span><span class="n">aperture</span><span class="o">*</span><span class="n">J01</span><span class="p">],[</span><span class="n">aperture</span><span class="o">*</span><span class="n">J10</span><span class="p">,</span><span class="n">aperture</span><span class="o">*</span><span class="n">J11</span><span class="p">]],</span><span class="n">pupil_grid</span><span class="p">)</span>
<span class="n">stokes_vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
<span class="n">partially_polarized_wavefront</span> <span class="o">=</span> <span class="n">Wavefront</span><span class="p">(</span><span class="n">jones_matrix</span><span class="p">,</span> <span class="n">input_stokes_vector</span><span class="o">=</span><span class="n">stokes_vector</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">imshow_stokes_vector</span><span class="p">(</span><span class="n">wavefront</span><span class="p">):</span>
    <span class="n">I_max</span> <span class="o">=</span> <span class="n">wavefront</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
    <span class="n">imshow_field</span><span class="p">(</span><span class="n">wavefront</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>
    <span class="n">imshow_field</span><span class="p">(</span><span class="n">wavefront</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">I_max</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">I_max</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>
    <span class="n">imshow_field</span><span class="p">(</span><span class="n">wavefront</span><span class="o">.</span><span class="n">U</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">I_max</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">I_max</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span>
    <span class="n">imshow_field</span><span class="p">(</span><span class="n">wavefront</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">I_max</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">I_max</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Partially Polarized wavefront&#39;</span><span class="p">)</span>
<span class="n">imshow_stokes_vector</span><span class="p">(</span><span class="n">partially_polarized_wavefront</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_21_0.png" src="../_images/notebooks_jonespupils_21_0.png" />
</div>
</div>
</section>
<section id="Time-to-send-the-wavefront-through-the-Fraunhofer-Propagator">
<h2>Time to send the wavefront through the Fraunhofer Propagator<a class="headerlink" href="#Time-to-send-the-wavefront-through-the-Fraunhofer-Propagator" title="Permalink to this headline"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[97]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">focal_grid</span> <span class="o">=</span> <span class="n">make_focal_grid</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">prop</span> <span class="o">=</span> <span class="n">FraunhoferPropagator</span><span class="p">(</span><span class="n">pupil_grid</span><span class="p">,</span> <span class="n">focal_grid</span><span class="p">)</span>
<span class="n">partially_polarized_image</span> <span class="o">=</span> <span class="n">prop</span><span class="p">(</span><span class="n">partially_polarized_wavefront</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Partially polarized wavefront&#39;</span><span class="p">)</span>
<span class="n">imshow_stokes_vector</span><span class="p">(</span><span class="n">partially_polarized_image</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_24_0.png" src="../_images/notebooks_jonespupils_24_0.png" />
</div>
</div>
</section>
<section id="Now-Pass-this-data-through-a-linear-polarizing-beam-splitter">
<h2>Now Pass this data through a linear polarizing beam splitter<a class="headerlink" href="#Now-Pass-this-data-through-a-linear-polarizing-beam-splitter" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[106]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unpolarized Star</span>
<span class="n">stokes_vector_planet</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">contrast</span> <span class="o">=</span> <span class="mf">3e-4</span>
<span class="n">angular_separation</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># lambda / D</span>
<span class="n">num_photons_star</span> <span class="o">=</span> <span class="mf">1e9</span>

<span class="n">wf_star</span> <span class="o">=</span> <span class="n">Wavefront</span><span class="p">(</span><span class="n">aperture</span><span class="p">)</span>
<span class="n">wf_star</span><span class="o">.</span><span class="n">total_power</span> <span class="o">=</span> <span class="n">num_photons_star</span>

<span class="n">e_planet</span> <span class="o">=</span> <span class="n">aperture</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">pupil_grid</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">angular_separation</span><span class="p">)</span>
<span class="n">wf_planet</span> <span class="o">=</span> <span class="n">Wavefront</span><span class="p">(</span><span class="n">jones_matrix</span><span class="o">*</span><span class="n">e_planet</span><span class="p">,</span> <span class="n">input_stokes_vector</span><span class="o">=</span><span class="n">stokes_vector_planet</span><span class="p">)</span>
<span class="n">wf_planet</span><span class="o">.</span><span class="n">total_power</span> <span class="o">=</span> <span class="n">num_photons_star</span> <span class="o">*</span> <span class="n">contrast</span>

<span class="c1"># Calculate science image for the star and planet</span>
<span class="n">science_image</span> <span class="o">=</span> <span class="n">prop</span><span class="p">(</span><span class="n">wf_star</span><span class="p">)</span><span class="o">.</span><span class="n">power</span>
<span class="n">science_image</span> <span class="o">+=</span> <span class="n">prop</span><span class="p">(</span><span class="n">wf_planet</span><span class="p">)</span><span class="o">.</span><span class="n">power</span>

<span class="c1"># Simulate photon noise</span>
<span class="n">science_image</span> <span class="o">=</span> <span class="n">large_poisson</span><span class="p">(</span><span class="n">science_image</span><span class="p">)</span>

<span class="n">imshow_field</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">science_image</span> <span class="o">/</span> <span class="n">science_image</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-20</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_26_0.png" src="../_images/notebooks_jonespupils_26_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[107]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pbs</span> <span class="o">=</span> <span class="n">LinearPolarizingBeamSplitter</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">img_star_1</span><span class="p">,</span> <span class="n">img_star_2</span> <span class="o">=</span> <span class="n">pbs</span><span class="p">(</span><span class="n">prop</span><span class="p">(</span><span class="n">wf_star</span><span class="p">))</span>
<span class="n">img_planet_1</span><span class="p">,</span> <span class="n">img_planet_2</span> <span class="o">=</span> <span class="n">pbs</span><span class="p">(</span><span class="n">prop</span><span class="p">(</span><span class="n">wf_planet</span><span class="p">))</span>

<span class="n">science_image_1</span> <span class="o">=</span> <span class="n">img_star_1</span><span class="o">.</span><span class="n">power</span> <span class="o">+</span> <span class="n">img_planet_1</span><span class="o">.</span><span class="n">power</span>
<span class="n">science_image_2</span> <span class="o">=</span> <span class="n">img_star_2</span><span class="o">.</span><span class="n">power</span> <span class="o">+</span> <span class="n">img_planet_2</span><span class="o">.</span><span class="n">power</span>

<span class="n">science_image_1</span> <span class="o">=</span> <span class="n">large_poisson</span><span class="p">(</span><span class="n">science_image_1</span><span class="p">)</span>
<span class="n">science_image_2</span> <span class="o">=</span> <span class="n">large_poisson</span><span class="p">(</span><span class="n">science_image_2</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Image for port 1&#39;</span><span class="p">)</span>
<span class="n">imshow_field</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">science_image_1</span> <span class="o">/</span> <span class="n">science_image_1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-20</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Image for port 2&#39;</span><span class="p">)</span>
<span class="n">imshow_field</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">science_image_2</span> <span class="o">/</span> <span class="n">science_image_2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-20</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Difference&#39;</span><span class="p">)</span>
<span class="n">imshow_field</span><span class="p">((</span><span class="n">science_image_1</span> <span class="o">-</span> <span class="n">science_image_2</span><span class="p">)</span> <span class="o">/</span> <span class="n">science_image_1</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">1e-4</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;planet&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;arrowstyle&#39;</span><span class="p">:</span> <span class="s1">&#39;-|&gt;&#39;</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_27_0.png" src="../_images/notebooks_jonespupils_27_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_27_1.png" src="../_images/notebooks_jonespupils_27_1.png" />
</div>
</div>
</section>
<section id="Great!-Now-let’s-try-the-same-with-Poppy">
<h2>Great! Now let’s try the same with Poppy<a class="headerlink" href="#Great!-Now-let’s-try-the-same-with-Poppy" title="Permalink to this headline"></a></h2>
<p>Poppy requires a good deal of hand-holding re: polarization because it doesn’t support polarized propagation (yet!). But we can leverage what we know about the electric field to compute a simmilar result!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[109]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">poppy</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[146]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">FocusMagellan</span><span class="p">(</span><span class="n">JonesVector</span><span class="p">,</span><span class="n">JonesPupil</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This treats the elements of the complex jones pupil as individual wavefronts that are then propagated</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">jones_vector_out</span> <span class="o">=</span> <span class="n">JonesPupil</span><span class="p">[</span><span class="o">...</span><span class="p">,:</span><span class="mi">2</span><span class="p">,:</span><span class="mi">2</span><span class="p">]</span> <span class="o">@</span> <span class="n">JonesVector</span>
    <span class="n">Ex</span> <span class="o">=</span> <span class="n">jones_vector_out</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">])</span>
    <span class="n">Ey</span> <span class="o">=</span> <span class="n">jones_vector_out</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">])</span>

    <span class="n">Wx</span> <span class="o">=</span> <span class="n">poppy</span><span class="o">.</span><span class="n">Wavefront</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="mf">551e-9</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span><span class="n">npix</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span><span class="n">diam</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span><span class="n">oversample</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Wx</span><span class="o">.</span><span class="n">wavefront</span> <span class="o">=</span> <span class="n">Ex</span>

    <span class="n">Wy</span> <span class="o">=</span> <span class="n">poppy</span><span class="o">.</span><span class="n">Wavefront</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="mf">551e-9</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span><span class="n">npix</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span><span class="n">diam</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span><span class="n">oversample</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Wy</span><span class="o">.</span><span class="n">wavefront</span> <span class="o">=</span> <span class="n">Ey</span>

    <span class="n">osys</span> <span class="o">=</span> <span class="n">poppy</span><span class="o">.</span><span class="n">OpticalSystem</span><span class="p">(</span><span class="n">pupil_diameter</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span><span class="n">oversample</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">npix</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">osys</span><span class="o">.</span><span class="n">add_pupil</span><span class="p">(</span><span class="n">poppy</span><span class="o">.</span><span class="n">AsymmetricSecondaryObscuration</span><span class="p">(</span><span class="n">secondary_radius</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
                                             <span class="n">support_angle</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span>
                                             <span class="n">support_width</span><span class="o">=</span><span class="p">[</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">],</span>
                                             <span class="n">support_offset_x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Complex secondary&#39;</span><span class="p">))</span>
    <span class="n">osys</span><span class="o">.</span><span class="n">add_pupil</span><span class="p">(</span><span class="n">poppy</span><span class="o">.</span><span class="n">CircularAperture</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>
    <span class="n">osys</span><span class="o">.</span><span class="n">add_detector</span><span class="p">(</span><span class="n">pixelscale</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">fov_arcsec</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>

    <span class="n">psfx</span> <span class="o">=</span> <span class="n">osys</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span><span class="n">Wx</span><span class="p">)</span>
    <span class="n">psfy</span> <span class="o">=</span> <span class="n">osys</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span><span class="n">Wy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">psfx</span><span class="p">,</span><span class="n">psfy</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[162]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ex</span><span class="p">,</span><span class="n">Ey</span> <span class="o">=</span> <span class="n">FocusMagellan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">raybundle</span><span class="o">.</span><span class="n">JonesPupil</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">Ex</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">Ey</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Just add the two wavefronts!</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">Ex</span> <span class="o">+</span> <span class="n">Ey</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">E</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_31_0.png" src="../_images/notebooks_jonespupils_31_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_31_1.png" src="../_images/notebooks_jonespupils_31_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_jonespupils_31_2.png" src="../_images/notebooks_jonespupils_31_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[154]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introtopolarization.html" class="btn btn-neutral float-left" title="Intro to Poke: Polarization Ray Tracing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="aboutpoke.html" class="btn btn-neutral float-right" title="About poke" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Jaren N. Ashcraft.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>